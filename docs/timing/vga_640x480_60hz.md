# VGA Timing Specification: 640x480 @ 60Hz

**Standard**: VESA VGA
**Resolution**: 640x480 pixels
**Refresh Rate**: 60Hz
**Pixel Clock**: 25.175 MHz (actual: 25.175 MHz)
**Aspect Ratio**: 4:3

## Timing Parameters

### Horizontal Timing

| Parameter | Pixels | Time (μs) |
|-----------|--------|-----------|
| Visible area | 640 | 25.42 |
| Front porch | 16 | 0.64 |
| Sync pulse | 96 | 3.81 |
| Back porch | 48 | 1.91 |
| **Total line** | **800** | **31.78** |

**Horizontal Sync Polarity**: Negative (active low)

### Vertical Timing

| Parameter | Lines | Time (ms) |
|-----------|-------|-----------|
| Visible area | 480 | 15.25 |
| Front porch | 10 | 0.32 |
| Sync pulse | 2 | 0.06 |
| Back porch | 33 | 1.05 |
| **Total frame** | **525** | **16.68** |

**Vertical Sync Polarity**: Negative (active low)

## Timing Diagrams

### Horizontal Timing Waveform

```
         |<-------- Total = 800 pixels -------->|
         |<- Visible ->|
         |    640      |
    _____|_____________|____    ____    _________
         |             |    |  |    |  |
         |             |FP  |  |SP  |  |BP
         |             |16  |  |96  |  |48
         |             |____|  |____|  |

    Hsync: ‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾____‾‾‾‾‾‾‾‾
                                   ↑
                              Negative pulse
```

### Vertical Timing Waveform

```
         |<-------- Total = 525 lines --------->|
         |<- Visible ->|
         |    480      |
    _____|_____________|___    ___    ___________
         |             |   |  |   |  |
         |             |FP |  |SP |  |BP
         |             |10 |  |2  |  |33
         |             |___|  |___|  |

    Vsync: ‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾____‾‾‾‾‾‾‾‾
                                   ↑
                              Negative pulse
```

## Display Enable (DE) Signal

The Display Enable signal indicates when pixel data is valid and should be displayed:

- **DE = 1**: During visible area (640x480 active pixels)
- **DE = 0**: During blanking intervals (front porch, sync, back porch)

```
Position: (h_pos, v_pos)
DE = (h_pos < 640) && (v_pos < 480)
```

## Implementation Guidelines

### Counter Values

**Horizontal Counter** (h_count):
- Range: 0 to 799
- Reset to 0 at 800
- Visible region: 0 to 639
- Front porch: 640 to 655
- Sync pulse: 656 to 751
- Back porch: 752 to 799

**Vertical Counter** (v_count):
- Range: 0 to 524
- Reset to 0 at 525
- Increments when h_count wraps
- Visible region: 0 to 479
- Front porch: 480 to 489
- Sync pulse: 490 to 491
- Back porch: 492 to 524

### Verilog Implementation Example

```verilog
// Horizontal counter
always @(posedge clk_pixel) begin
    if (reset) begin
        h_count <= 0;
    end else begin
        if (h_count == 799) begin
            h_count <= 0;
        end else begin
            h_count <= h_count + 1;
        end
    end
end

// Vertical counter
always @(posedge clk_pixel) begin
    if (reset) begin
        v_count <= 0;
    end else begin
        if (h_count == 799) begin
            if (v_count == 524) begin
                v_count <= 0;
            end else begin
                v_count <= v_count + 1;
            end
        end
    end
end

// Sync signals (negative polarity)
assign hsync = !((h_count >= 656) && (h_count < 752));
assign vsync = !((v_count >= 490) && (v_count < 492));

// Display Enable
assign de = (h_count < 640) && (v_count < 480);
```

## Character Display Mapping

For a character-based display using 8x16 pixel characters:

### 40-Column Mode
- Characters per line: 40
- Lines per screen: 30 (480 / 16 = 30)
- Horizontal character position: h_count / 16
- Vertical character position: v_count / 16
- Pixel within character (X): h_count % 16 (but character is 8 wide, so use h_count[2:0])
- Scanline within character: v_count % 16 (v_count[3:0])

### 80-Column Mode
- Characters per line: 80
- Lines per screen: 30
- Horizontal character position: h_count / 8
- Vertical character position: v_count / 16
- Pixel within character (X): h_count % 8 (h_count[2:0])
- Scanline within character: v_count % 16 (v_count[3:0])

## Clock Generation

**Pixel Clock**: 25.175 MHz
- For ECP5 FPGA: Use EHXPLLL PLL primitive
- Input: Board oscillator (typically 25 MHz on Colorlight i5)
- Output: 25.175 MHz pixel clock

**TMDS Clock**: 251.75 MHz (10x pixel clock)
- Required for TMDS serialization
- Generated by same PLL as pixel clock

### PLL Configuration Example

```verilog
EHXPLLL #(
    .CLKI_DIV(5),           // Divide input by 5: 25 MHz / 5 = 5 MHz
    .CLKFB_DIV(50),         // Multiply by 50: 5 MHz * 50 = 250 MHz
    .CLKOP_DIV(10),         // Pixel clock: 250 MHz / 10 = 25 MHz (close to 25.175)
    .CLKOS_DIV(1)           // TMDS clock: 250 MHz / 1 = 250 MHz (close to 251.75)
) pll_inst (
    .CLKI(clk_25mhz),
    .CLKOP(clk_pixel),
    .CLKOS(clk_tmds),
    // ... other ports
);
```

Note: The exact dividers may need adjustment based on the actual board oscillator frequency.

## References

- VESA DMT Standard v1.0
- http://www.tinyvga.com/vga-timing/640x480@60Hz
- http://martin.hinner.info/vga/timing.html

## See Also

- [Character Rendering Pipeline](../modules/character_rendering.md)
- [Clock Domain Crossing](clock_domains.md)
- [DVI Signal Generation](../modules/dvi_timing.md)
